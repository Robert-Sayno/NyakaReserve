<?php
// Database connection details
// Database connection parameters
$servername = 'localhost';
$username = 'root';
$password = '';
$dbname = 'NyakaReserve';
// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);

// Check connection
if ($conn->connect_error) {
  die("Connection failed: " . $conn->connect_error);
}

// Process form submission
if ($_SERVER["REQUEST_METHOD"] == "POST") {
  // Collect form data
  $activity = $_POST["activity"];
  $days = $_POST["days"];
  $place = $_POST["place"];

  // Remove non-numeric characters from amount
  $amount = filter_var($_POST["amount"], FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);

  // Get full path of the uploaded image
  $targetDirectory = __DIR__ . "/uploads/"; // Absolute path using __DIR__
  $filename = basename($_FILES["courtesyPhoto"]["name"]);
  $targetFile = $targetDirectory . $filename;

  // Move the file to the target directory
  move_uploaded_file($_FILES["courtesyPhoto"]["tmp_name"], $targetFile);

  // Build database query with full path
  $sql = "INSERT INTO tours (activity, days, place, amount, courtesy_photo) VALUES ('$activity', $days, '$place', $amount, '$targetFile')";

  if ($conn->query($sql) === TRUE) {
    echo "Tour added successfully";
  } else {
    echo "Error: " . $sql . "<br>" . $conn->error;
  }
}

// Close the database connection
$conn->close();
?>
